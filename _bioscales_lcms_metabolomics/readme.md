# Study id
nmdc:sty-11-r2h77870

_Note that we are only processing the rhizosphere samples which have "rhizo", "leaf", or "root" in the name_ (roughly 1350 MS runs).

# Raw data
Massive id = MSV000090886
ftp link = ftp://massive-ftp.ucsd.edu/v05/MSV000090886/raw

First pull the ftp locations using the following command:
```bash
wget --spider -r -nd ftp://massive-ftp.ucsd.edu/v05/MSV000090886/raw -o _bioscales_lcms_metabolomics/bioscales_massive_ftp_locs.txt
```

Next download the raw files using the `_bioscales_lcms_metabolomics/scripts/file_puller.py`.
This will download files to `/Users/heal742/Library/CloudStorage/OneDrive-PNNL/Documents/_DMS_data/_NMDC/_massive/_bioscales_lcms/to_process` and write a file `_bioscales_lcms_metabolomics/bioscales_ftp_locs.csv` with the ftp locations of the files that were downloaded and the raw file name.  Note that this will only download files that are tagged with "rhizo", "leaf", or "root"" in the name.

Next get start and end times, instrument details using `scripts/raw_file_info_pull_logger.py` script (writes `_emp_500_lcms_metabolomics/raw_file_info_TIMESTAMP.csv` and `_emp_500_lcms_metabolomics/processing_errors_TIMESTAMP.csv`)

# Configurations
Configurations generated guided by documentation here: https://www.nature.com/articles/s41597-024-03069-7 and looking at the instrument/running details that are the output of the `scripts/raw_file_info_pull_logger.py` script (see Mapping section below).

There are two chromatogram configurations - one for HILICZ and one for C18.

There are be four mass spectrometer configurations - two for the positive ion mode (at two different collision energies) and two for the negative ion mode (at two different collision energies).

There are two mass spec configurations for each chromat run - one for collision energy 102040 and another for 205060

Configurations generated by `_bioscales_lcms_metabolomics_/config_generation.py` and written to `_bioscales_lcms_metabolomics/metadata/configs.json`.

# Instrument
New instrument used in this study: "Thermo Orbitrap IQ-X Tribrid (IQX) mass spectrometer"
Script to generate this here: `_bioscales_lcms_metabolomics/scripts/instrument_generation.py`
Metadata saved here: `_bioscales_lcms_metabolomics/metadata/instrument.json`

# Sample mapping and metadata generation input file prep
Files are mapped to exisiting NMDC biosamples, configurations, and instruments in the script `_bioscales_lcms_metabolomics/scripts/biosample_mapper.py`.
Output are written to `_bioscales_lcms_metabolomics/metadata/mapped_biosamples.json`.

Instrument start/end times, instrument details, and raw file names are pulled from the output of the `scripts/raw_file_info_pull_logger.py` script, which is saved as `_bioscales_lcms_metabolomics/bioscales_file_info/raw_file_info_TIMESTAMP.csv`.

These are combined to prepare the metadata generation input file in the script `_bioscales_lcms_metabolomics/scripts/workflow_metadata_prepper.py`.

# Generate four batches of processing scripts
The script `_bioscales_lcms_metabolomics/scripts/wdl_json_prepper.py` generates four types of json files for processing the data in four batches:
- RP positive mode
- RP negative mode
- HILIC positive mode
- HILIC negative mode

These use the configurations and mapped biosamples generated in the previous steps.

# Shell script to run the batches: `_bioscales_lcms_metabolomics/scripts/bioscales_metams_wdl_runner.sh`
`bash /Users/heal742/LOCAL/05_NMDC/02_MetaMS/data_processing/_bioscales_lcms_metabolomics/scripts/bioscales_metams_wdl_runner.sh`